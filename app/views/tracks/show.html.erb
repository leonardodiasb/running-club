<%= link_to root_url do %>
  <p>BACK</p>
<% end %>
<h1>This track exists</h1>
<p>TIME SPENT:<%= @track.time %></p>
<p>CREATED AT:<%= @track.created_at%></p>

<div style="display: flex; flex-wrap: wrap;">
  <div style="border-right: 1px solid;">
    <p>LAT:</p>
    <div>
      <%= content_tag "div", id: "lat", data: {lat: @track.latitude} do %>
      <% end %>
      <% @track.latitude.each do |lat| %>
        <p><%= lat %></p>
      <% end %>
    </div>
  </div>
  <div style="border-right: 1px solid;">
    <p>LONG:</p>
    <div>
      <%= content_tag "div", id: "long", data: {long: @track.longitude} do %>
      <% end %>
      <% @track.longitude.each do |long| %>
        <p><%= long %></p>
    <% end %>
    </div>
  </div>
  <div style="border-right: 1px solid;">
    <p>TIMESTAMP:</p>
    <div>
      <% @track.timestp.each do |tmstp| %>
        <p><%= tmstp - @track.timestp[0] %></p>
    <% end %>
    </div>
  </div>
  <div style="border-right: 1px solid;">
    <p>TIME FROM TIMESTAMP:</p>
    <div>
      <%= @tm %>
    </div>
  </div>
  <div style="border-right: 1px solid;">
    <p>SPEED:</p>
    <div>
      <% @track.speed.each do |spd| %>
        <p><%= spd %></p>
      <% end %>
    </div>
  </div>
</div>

<div id='map' style='width: 400px; height: 300px;'></div>
<script>

  var coord = [];
  var latElement = document.getElementById('lat');
  var lat = JSON.parse(latElement.dataset.lat);
  var longElement = document.getElementById('long');
  var long = JSON.parse(longElement.dataset.long);

  for(var i = 0; i < lat.length; i ++) {
    coord.push([long[i], lat[i]]);
  }

  mapboxgl.accessToken = 'pk.eyJ1IjoibGVvbmRpYXNiIiwiYSI6ImNsMHJiNGJyeDAxcnQzZG9wNDZwajNuNDYifQ.47GK1AdHnqacQY-pPpxK_Q';
  var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: coord[Math.floor(coord.length/2)],
    zoom: 15
  });
  
  map.on('load', () => {
    map.addSource('route', {
      'type': 'geojson',
      'data': {
        'type': 'Feature',
        'properties': {},
        'geometry': {
          'type': 'LineString',
          'coordinates': coord
        }
      }
    });
    map.addLayer({
      'id': 'route',
      'type': 'line',
      'source': 'route',
      'layout': {
        'line-join': 'round',
        'line-cap': 'round'
      },
      'paint': {
        'line-color': '#888',
        'line-width': 8
      }
    });
  });
</script>